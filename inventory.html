<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>üì¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Inventory)</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<!-- Google Fonts: Sarabun -->
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />
<style>
  /* Reset & Base */
  body {
    font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #e0eafc, #cfdef3);
    min-height: 100vh;
    margin: 0;
    padding: 2rem 1rem;
    color: #212529;
  }
  h1 {
    font-weight: 700;
    text-align: center;
    margin-bottom: 2rem;
    color: #3b3e66;
    letter-spacing: 2px;
    user-select: none;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
  }

  /* Buttons group */
  .action-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .btn {
    border-radius: 50px;
    padding: 0.75rem 1.8rem;
    font-weight: 600;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
    transition: all 0.3s ease;
  }
  .btn-primary {
    background: #5a67d8;
    border-color: #5a67d8;
    box-shadow: 0 6px 12px rgb(90 103 216 / 0.35);
  }
  .btn-primary:hover, .btn-primary:focus {
    background: #434bbd;
    border-color: #434bbd;
    box-shadow: 0 8px 20px rgb(67 75 189 / 0.45);
  }
  .btn-success {
    background: #48bb78;
    border-color: #48bb78;
    box-shadow: 0 6px 12px rgb(72 187 120 / 0.35);
  }
  .btn-success:hover, .btn-success:focus {
    background: #3da66a;
    border-color: #3da66a;
    box-shadow: 0 8px 20px rgb(61 166 106 / 0.45);
  }
  .btn-info {
    background: #38bdf8;
    border-color: #38bdf8;
    box-shadow: 0 6px 12px rgb(56 223 248 / 0.35);
  }
  .btn-info:hover, .btn-info:focus {
    background: #0ea5e9;
    border-color: #0ea5e9;
    box-shadow: 0 8px 20px rgb(14 165 233 / 0.45);
  }
  .btn-secondary {
    background: #94a3b8;
    border-color: #94a3b8;
    box-shadow: 0 6px 12px rgb(148 163 184 / 0.35);
  }
  .btn-secondary:hover, .btn-secondary:focus {
    background: #64748b;
    border-color: #64748b;
    box-shadow: 0 8px 20px rgb(100 116 139 / 0.45);
    color: #fff;
  }

  /* Toggle Manage Button */
  #toggleManage {
    min-width: 200px;
  }

  /* Table Styling */
  .table {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.1);
  }
  thead.table-dark {
    background: linear-gradient(90deg, #5a67d8, #434bbd);
    color: #fff;
  }
  tbody tr:hover {
    background-color: #f1f5fb;
  }
  .quantity-low {
    color: #e53e3e;
    font-weight: 700;
  }
  .badge {
    font-weight: 600;
  }
  /* Item images */
  .item-image {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: 0.75rem;
    cursor: pointer;
    transition: transform 0.25s ease;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
  }
  .item-image:hover {
    transform: scale(1.12);
    box-shadow: 0 8px 15px rgb(0 0 0 / 0.15);
  }

  /* Mobile Cards */
  .card {
    border-radius: 16px;
    box-shadow: 0 10px 25px rgb(0 0 0 / 0.08);
    overflow: hidden;
    transition: box-shadow 0.3s ease;
  }
  .card:hover {
    box-shadow: 0 15px 30px rgb(0 0 0 / 0.12);
  }
  .card img {
    border-radius: 0;
    transition: transform 0.25s ease;
  }
  .card img:hover {
    transform: scale(1.1);
  }
  .card-body h6 {
    font-weight: 700;
    color: #2c2f4a;
  }
  .card-body .small.text-muted {
    color: #718096;
  }

  /* Modal */
  .modal-content.bg-dark {
    border: none;
    background-color: #1a202c !important;
  }
  #modalImage {
    max-height: 80vh;
    object-fit: contain;
    border-radius: 0.75rem;
  }

  /* PIN Modal */
  #pinModal .modal-content {
    border-radius: 1rem;
    box-shadow: 0 15px 30px rgb(0 0 0 / 0.25);
  }
  #pinModal .modal-header {
    background: #5a67d8;
    color: #fff;
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
  }
  #pinModal .modal-header h5 {
    font-weight: 700;
    font-size: 1.5rem;
  }
  #pinModal .form-control {
    letter-spacing: 1.5rem;
    font-weight: 700;
    border-radius: 50px;
    border: 3px solid #5a67d8;
    padding: 0.75rem 0;
    text-align: center;
    font-size: 2.8rem;
    transition: border-color 0.3s ease;
  }
  #pinModal .form-control:focus {
    border-color: #434bbd;
    box-shadow: 0 0 8px #434bbdaa;
  }
  #pinError {
    font-weight: 600;
  }
  #pinModal .modal-footer {
    justify-content: center;
  }
  #pinModal .btn-primary {
    background: #5a67d8;
    border-color: #5a67d8;
    font-size: 1.25rem;
    padding: 0.6rem 3rem;
    border-radius: 50px;
    box-shadow: 0 8px 20px rgb(90 103 216 / 0.4);
    transition: all 0.3s ease;
  }
  #pinModal .btn-primary:hover,      
  #pinModal .btn-primary:focus {
    background: #434bbd;
    border-color: #434bbd;
    box-shadow: 0 10px 28px rgb(67 75 189 / 0.6);
  }
  #pinModal .btn-outline-secondary {
    font-size: 1.1rem;
    padding: 0.5rem 2.5rem;
    border-radius: 50px;
  }

  /* Responsive tweaks */
  @media (max-width: 576px) {
    .btn {
      font-size: 0.95rem;
      padding: 0.6rem 1.2rem;
    }
    #pinModal .form-control {
      font-size: 2rem;
      letter-spacing: 1.2rem;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>üì¶ STORE INVENTORY</h1>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <a href="{% url 'cart' %}" class="btn btn-primary shadow-sm" title="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å">
      <i class="bi bi-card-checklist me-2"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    </a>

    <button class="btn btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#pinModal" title="‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Dashboard">
      <i class="bi bi-bar-chart-line-fill me-2"></i> Dashboards
    </button>

    <a href="{% url 'add_item' %}" class="btn btn-success shadow-sm manage-btn" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà">
      <i class="bi bi-plus-circle me-2"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
    </a>

    <a href="{% url 'transaction_history' %}" class="btn btn-info shadow-sm manage-btn" title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">
      <i class="bi bi-journal-text me-2"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
    </a>

    <button id="toggleManage" class="btn btn-secondary shadow-sm" title="‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£">
      <i class="bi bi-eye-slash me-2"></i> ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
    </button>
  </div>

  <!-- Filter by Company -->
  <div class="mb-4 d-flex justify-content-center gap-3 align-items-center">
    <label for="companyFilter" class="form-label fw-bold mb-0">‡∏Å‡∏£‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</label>
    <select id="companyFilter" class="form-select w-auto">
      <option value="all" selected>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      <option value="CSW">CSW</option>
      <option value="PFF">PFF</option>
    </select>
  </div>

  <!-- Desktop Table -->
  <div class="d-none d-md-block">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>‡∏£‡∏π‡∏õ</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</th> <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° -->
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
            <th class="text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr data-company="{{ item.company }}">
            <td>
              {% if item.image %}
              <img src="{{ item.image.url }}" alt="{{ item.name }}" class="item-image" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-image="{{ item.image.url }}">
              {% else %}
              <span class="text-muted small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>
              {% endif %}
            </td>
            <td class="fw-bold">{{ item.name }}</td>
            <td><span class="badge bg-secondary">{{ item.code }}</span></td>
            <td>{{ item.company }}</td> <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó -->
            <td class="{% if item.quantity < 5 %}quantity-low{% endif %}">{{ item.quantity }} {{ item.unit }}</td>
            <td>
              <div class="d-flex flex-wrap gap-2 justify-content-center">
                {% if item.quantity > 0 %}
                <form action="{% url 'add_to_cart' item.id %}" method="post" class="d-flex gap-1 align-items-center">
                  {% csrf_token %}
                  <input type="number" step="0.01" name="quantity" value="0.5" min="0.01" class="form-control form-control-sm" style="width:70px;" required>
                  <span class="align-self-center">{{ item.unit }}</span>
                  <button type="submit" class="btn btn-success btn-sm" title="‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <i class="bi bi-truck"></i>
                  </button>
                </form>
                {% else %}
                <span class="text-danger fw-semibold">‡∏´‡∏°‡∏î</span>
                {% endif %}

                <form action="{% url 'increase_item' item.id %}" method="post" class="d-flex gap-1 manage-btn" style="align-items:center;">
                  {% csrf_token %}
                  <input type="number" step="0.01" name="quantity" value="1" min="0.01" class="form-control form-control-sm" style="width:70px;" required>
                  <span class="align-self-center">{{ item.unit }}</span>
                  <button type="submit" class="btn btn-info btn-sm" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <i class="bi bi-plus-circle-fill"></i>
                  </button>
                </form>

                <form action="{% url 'use_item' item.id %}" method="post" class="d-flex gap-1 manage-btn" style="align-items:center;">
                  {% csrf_token %}
                  <input type="number" step="0.01" name="quantity" value="1" min="0.01"
                        class="form-control form-control-sm" style="width:70px;" required>
                  <span class="align-self-center">{{ item.unit }}</span>
                  <button type="submit" class="btn btn-warning btn-sm" title="‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ä‡πâ">
                    <div class="wood-box">
                      üì¶
                    </div>
                  </button>
                </form>

                <form action="{% url 'delete_item' item.id %}" method="post" class="manage-btn" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ {{ item.name }} ?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm" title="‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-center text-muted py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Mobile Cards -->
  <div class="d-block d-md-none">
    {% for item in items %}
    <div class="card mb-3" data-company="{{ item.company }}">
      <div class="row g-0 align-items-center">
        <div class="col-4 text-center p-2 bg-white">
          {% if item.image %}
          <img src="{{ item.image.url }}" alt="{{ item.name }}" class="img-fluid rounded" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-image="{{ item.image.url }}">
          {% else %}
          <div class="text-muted small mt-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>
          {% endif %}
        </div>
        <div class="col-8">
          <div class="card-body p-3">
            <h6 class="card-title">{{ item.name }}</h6>
            <div class="small text-muted mb-1">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: {{ item.company }}</div> <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó -->
            <div class="small text-muted mb-1">‡∏£‡∏´‡∏±‡∏™: {{ item.code }}</div>
            <div class="{% if item.quantity < 5 %}quantity-low{% endif %} fw-semibold">
              ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ item.quantity }} {{ item.unit }}
            </div>
            <div class="mt-3 d-flex flex-wrap gap-2 align-items-center">
              {% if item.quantity > 0 %}
              <form action="{% url 'add_to_cart' item.id %}" method="post" class="d-flex gap-1 flex-grow-1">
                {% csrf_token %}
                <input type="number" step="0.01" name="quantity" value="0.5" min="0.01" class="form-control form-control-sm" style="width:60px;" required>
                <span class="align-self-center">{{ item.unit }}</span>
                <button type="submit" class="btn btn-success btn-sm" title="‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                  <i class="bi bi-truck"></i>
                </button>
              </form>
              {% else %}
              <span class="text-danger small fw-semibold me-2">‡∏´‡∏°‡∏î</span>
              {% endif %}
              <form action="{% url 'increase_item' item.id %}" method="post" class="d-flex gap-1 manage-btn">
                {% csrf_token %}
                <input type="number" step="0.01" name="quantity" value="1" min="0.01" class="form-control form-control-sm" style="width:60px;" required>
                <span class="align-self-center">{{ item.unit }}</span>
                <button type="submit" class="btn btn-info btn-sm" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                  <i class="bi bi-plus-circle-fill"></i>
                </button>
              </form>
              <form action="{% url 'use_item' item.id %}" method="post" class="d-flex gap-1 manage-btn" style="align-items:center;">
                  {% csrf_token %}
                  <input type="number" step="0.01" name="quantity" value="1" min="0.01"
                        class="form-control form-control-sm" style="width:70px;" required>
                  <span class="align-self-center">{{ item.unit }}</span>
                  <button type="submit" class="btn btn-warning btn-sm" title="‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ä‡πâ">
                    üì¶
                  </button>
                </form>
              <form action="{% url 'delete_item' item.id %}" method="post" class="manage-btn" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö {{ item.name }} ?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm" title="‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-center text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    {% endfor %}
  </div>
</div>

<!-- Modal: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true" aria-labelledby="imageModalLabel" data-bs-backdrop="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content bg-dark shadow-lg rounded-4">
      <div class="modal-body p-3 text-center">
        <img src="" id="modalImage" alt="‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="img-fluid rounded" />
      </div>
    </div>
  </div>
</div>

<!-- Modal PIN -->
<div class="modal fade" id="pinModal" tabindex="-1" aria-labelledby="pinModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pinModalLabel">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤ Dashboard</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="‡∏õ‡∏¥‡∏î"></button>
      </div>
      <form id="pinForm" autocomplete="off">
        <div class="modal-body">
          <input id="pinInput" type="password" maxlength="4" pattern="[0-9]{4}" required placeholder="____" class="form-control" autofocus />
          <small id="pinError" class="text-danger d-none">PIN ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</small>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle + Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà ---
  const imageModal = document.getElementById('imageModal');
  const modalImage = document.getElementById('modalImage');
  imageModal.addEventListener('show.bs.modal', event => {
    const trigger = event.relatedTarget;
    if (!trigger) return;
    const src = trigger.getAttribute('data-bs-image');
    modalImage.src = src;
  });

  // --- Toggle Manage Buttons ---
  const toggleBtn = document.getElementById('toggleManage');
  const manageButtons = document.querySelectorAll('.manage-btn');

  function setManageButtonsVisible(show) {
    manageButtons.forEach(btn => {
      btn.style.display = show ? '' : 'none';
    });
    toggleBtn.innerHTML = show
      ? '<i class="bi bi-eye-slash me-2"></i> ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£'
      : '<i class="bi bi-eye me-2"></i> ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£';
    localStorage.setItem('showManageButtons', show ? 'true' : 'false');
  }

  // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å localStorage
  let showManage = localStorage.getItem('showManageButtons');
  if (showManage === null) showManage = 'true';
  setManageButtonsVisible(showManage === 'true');

  toggleBtn.addEventListener('click', () => {
    showManage = (showManage === 'true') ? 'false' : 'true';
    setManageButtonsVisible(showManage === 'true');
  });

  // --- Filter Company ---
  const companyFilter = document.getElementById('companyFilter');

  companyFilter.addEventListener('change', () => {
    const val = companyFilter.value;

    // Desktop rows
    document.querySelectorAll('tbody tr[data-company]').forEach(row => {
      if (val === 'all' || row.getAttribute('data-company') === val) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });

    // Mobile cards
    document.querySelectorAll('.d-block.d-md-none .card[data-company]').forEach(card => {
      if (val === 'all' || card.getAttribute('data-company') === val) {
        card.style.display = '';
      } else {
        card.style.display = 'none';
      }
    });
  });

  // --- PIN Modal ---
  const pinModal = new bootstrap.Modal(document.getElementById('pinModal'));
  const pinForm = document.getElementById('pinForm');
  const pinInput = document.getElementById('pinInput');
  const pinError = document.getElementById('pinError');

  pinForm.addEventListener('submit', e => {
    e.preventDefault();
    const pin = pinInput.value.trim();
    const correctPin = '8989'; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î PIN ‡∏à‡∏£‡∏¥‡∏á

    if (pin === correctPin) {
      pinError.classList.add('d-none');
      pinModal.hide();
      window.location.href = "{% url 'dashboard' %}"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á Dashboard ‡∏à‡∏£‡∏¥‡∏á
    } else {
      pinError.classList.remove('d-none');
      pinInput.focus();
      pinInput.select();
    }
  });

  // ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå error ‡∏î‡πâ‡∏ß‡∏¢
  document.getElementById('pinModal').addEventListener('hidden.bs.modal', () => {
    pinError.classList.add('d-none');
    pinInput.value = '';
  });
</script>

</body>
</html>
